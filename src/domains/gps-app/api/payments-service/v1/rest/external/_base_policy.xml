<policies>
    <inbound>
        <base />
<!--        <set-variable name="fiscalCodeParam" value="@(context.Request.MatchedParameters["organizationfiscalcode"])" />-->
<!--        <set-variable name="organizationFiscalCode" value="@{-->
<!--            return context.Variables.ContainsKey("User.Id") ? context.User.Id : "Unknown" ;-->
<!--        }" />-->
<!--        <choose>-->
<!--            <when condition="@(!context.Variables.GetValueOrDefault<string>("fiscalCodeParam").Equals(context.Variables.GetValueOrDefault<string>("organizationFiscalCode")))">-->
<!--                <return-response>-->
<!--                    <set-status code="403" reason="Unauthorized, you have not permission access rights" />-->
<!--                </return-response>-->
<!--            </when>-->
<!--        </choose>-->
        <set-query-parameter name="pageNum" exists-action="skip">
            <value>0</value>
        </set-query-parameter>
        <set-query-parameter name="pageSize" exists-action="skip">
            <value>100</value>
        </set-query-parameter>
        <set-backend-service base-url="https://${hostname}/pagopa-gpd-payments" />
        <!-- Calling Authorizer's fragment -->
        <set-variable name="application_domain" value="gpd" />
        <choose>
          <!-- Making sure that will excludes all APIs that does not includes CI fiscal code -->
          <when condition="@(context.Request.MatchedParameters.ContainsKey("organizationfiscalcode"))">
            <set-variable name="authorization_entity" value="@(context.Request.MatchedParameters["organizationfiscalcode"])" />
            <include-fragment fragment-id="authorizer" />
          </when>
        </choose>
    </inbound>
    <outbound>
        <base />
    </outbound>
    <backend>
        <base />
    </backend>
    <on-error>
        <base />
    </on-error>
</policies>
