{
  "name": "onlineDataflow",
  "properties": {
    "type": "MappingDataFlow",
    "typeProperties": {
      "sources": [
        {
          "dataset": {
            "referenceName": "onlineMessaggiDataset",
            "type": "DatasetReference"
          },
          "name": "messaggiRead",
          "description": "Extract messaggi where timestamp_evento < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineCdInfoPagamentoDataset",
            "type": "DatasetReference"
          },
          "name": "cdInfoPagamentoRead",
          "description": "Extract cd_info_pagamento where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRptVersamentiBolloDataset",
            "type": "DatasetReference"
          },
          "name": "rptVersamentiBolloRead",
          "description": "Extract rpt_versamenti_bollo where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRptVersamentiDataset",
            "type": "DatasetReference"
          },
          "name": "rptVersamentiRead",
          "description": "Extract rpt_versamenti where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRptSoggettiDataset",
            "type": "DatasetReference"
          },
          "name": "rptSoggettiRead",
          "description": "Extract rpt_soggetti where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRptActivationsDataset",
            "type": "DatasetReference"
          },
          "name": "rptActivationsRead",
          "description": "Extract rpt_activations where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineStatiRptDataset",
            "type": "DatasetReference"
          },
          "name": "statiRptRead",
          "description": "Extract stati_rpt where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineStatiRptSnapshotDataset",
            "type": "DatasetReference"
          },
          "name": "statiRptSnapshotRead",
          "description": "Extract stati_rpt_snapshot where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineStatiCarrelloDataset",
            "type": "DatasetReference"
          },
          "name": "statiCarrelloRead",
          "description": "Extract stati_carrello where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineStatiCarrelloSnapshotDataset",
            "type": "DatasetReference"
          },
          "name": "statiCarrelloSnapshotRead",
          "description": "Extract stati_carrello_snapshot where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRtVersamentiBolloDataset",
            "type": "DatasetReference"
          },
          "name": "rtVersamentiBolloRead",
          "description": "Extract rt_versamenti_bollo where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRtVersamentiDataset",
            "type": "DatasetReference"
          },
          "name": "rtVersamentiRead",
          "description": "Extract rt_versamenti where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRtXmlDataset",
            "type": "DatasetReference"
          },
          "name": "rtXmlRead",
          "description": "Extract rt_xml where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRptXmlDataset",
            "type": "DatasetReference"
          },
          "name": "rptXmlRead",
          "description": "Extract rpt_xml where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePmSessionDataDataset",
            "type": "DatasetReference"
          },
          "name": "pmSessionDataRead",
          "description": "Extract pm_session_data where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePmMetadataDataset",
            "type": "DatasetReference"
          },
          "name": "pmMetadataRead",
          "description": "Extract pm_metadata where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineIdempotencyCacheDataset",
            "type": "DatasetReference"
          },
          "name": "idempotencyCacheRead",
          "description": "Extract idempotency_cache where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineNmuCancelUtilityDataset",
            "type": "DatasetReference"
          },
          "name": "nmuCancelUtilityRead",
          "description": "Extract nmu_cancel_utility where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionActivateDataset",
            "type": "DatasetReference"
          },
          "name": "positionActivateRead",
          "description": "Extract position_activate where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionPaymentStatusDataset",
            "type": "DatasetReference"
          },
          "name": "positionPaymentStatusRead",
          "description": "Extract position_payment_status where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionPaymentStatusSnapshotDataset",
            "type": "DatasetReference"
          },
          "name": "positionPaymentStatusSnapshotRead",
          "description": "Extract position_payment_status_snapshot where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionReceiptRecipientStatusDataset",
            "type": "DatasetReference"
          },
          "name": "positionReceiptRecipientStatusRead",
          "description": "Extract position_receipt_recipient_status where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionReceiptTransferDataset",
            "type": "DatasetReference"
          },
          "name": "positionReceiptTransferRead",
          "description": "Extract position_receipt_transfer where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionTransferDataset",
            "type": "DatasetReference"
          },
          "name": "positionTransferRead",
          "description": "Extract position_transfer where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionReceiptRecipientDataset",
            "type": "DatasetReference"
          },
          "name": "positionReceiptRecipientRead",
          "description": "Extract position_receipt_recipient where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionReceiptXmlDataset",
            "type": "DatasetReference"
          },
          "name": "positionReceiptXmlRead",
          "description": "Extract position_receipt_xml where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionReceiptDataset",
            "type": "DatasetReference"
          },
          "name": "positionReceiptRead",
          "description": "Extract position_receipt where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineTokenUtilityDataset",
            "type": "DatasetReference"
          },
          "name": "tokenUtilityRead",
          "description": "Extract token_utility where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionPaymentDataset",
            "type": "DatasetReference"
          },
          "name": "positionPaymentRead",
          "description": "Extract position_payment where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionPaymentPlanDataset",
            "type": "DatasetReference"
          },
          "name": "positionPaymentPlanRead",
          "description": "Extract position_payment_plan where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionStatusDataset",
            "type": "DatasetReference"
          },
          "name": "positionStatusRead",
          "description": "Extract position_status where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionStatusSnapshotDataset",
            "type": "DatasetReference"
          },
          "name": "positionStatusSnapshotRead",
          "description": "Extract position_status_snapshot where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionServiceDataset",
            "type": "DatasetReference"
          },
          "name": "positionServiceRead",
          "description": "Extract position_service where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionSubjectDataset",
            "type": "DatasetReference"
          },
          "name": "positionSubjectRead",
          "description": "Extract position_subject where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionTransferMbdDataset",
            "type": "DatasetReference"
          },
          "name": "positionTransferMbdRead",
          "description": "Extract position_transfer_mbd where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRtDataset",
            "type": "DatasetReference"
          },
          "name": "rtRead",
          "description": "Extract rt where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRptDataset",
            "type": "DatasetReference"
          },
          "name": "rptRead",
          "description": "Extract rpt where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineCarrelloDataset",
            "type": "DatasetReference"
          },
          "name": "carrelloRead",
          "description": "Extract carrello where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRetryRptNotificaCancellazioneDataset",
            "type": "DatasetReference"
          },
          "name": "retryRptNotificaCancellazioneRead",
          "description": "Extract retry_rpt_notifica_cancellazione where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRetryRptDataset",
            "type": "DatasetReference"
          },
          "name": "retryRptRead",
          "description": "Extract retry_rpt where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRetryPaAttivaRptDataset",
            "type": "DatasetReference"
          },
          "name": "retryPaAttivaRptRead",
          "description": "Extract retry_pa_attiva_rpt where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRetryPspNotificaCancellazioneRptDataset",
            "type": "DatasetReference"
          },
          "name": "retryPspNotificaCancellazioneRptRead",
          "description": "Extract retry_psp_notifica_cancellazione_rpt where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRetryPspAckDataset",
            "type": "DatasetReference"
          },
          "name": "retryPspAckRead",
          "description": "Extract retry_psp_ack where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRetryPaInviaRtDataset",
            "type": "DatasetReference"
          },
          "name": "retryPaInviaRtRead",
          "description": "Extract retry_pa_invia_rt where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionRetrySendpaymentresultDataset",
            "type": "DatasetReference"
          },
          "name": "positionRetrySendpaymentresultRead",
          "description": "Extract position_retry_sendpaymentresult where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionRetryPspSendPaymentDataset",
            "type": "DatasetReference"
          },
          "name": "positionRetryPspSendPaymentRead",
          "description": "Extract position_retry_psp_send_payment where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionRetryPaSendRtDataset",
            "type": "DatasetReference"
          },
          "name": "positionRetryPaSendRtRead",
          "description": "Extract position_retry_pa_send_rt where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineRegistroChiamateNotificaRtDataset",
            "type": "DatasetReference"
          },
          "name": "registroChiamateNotificaRtRead",
          "description": "Extract registro_chiamate_notifica_rt where inserted_timestamp < (today-n)"
        },
        {
          "dataset": {
            "referenceName": "onlineVerificaBollettinoDataset",
            "type": "DatasetReference"
          },
          "name": "verificaBollettinoRead",
          "description": "Extract verifica_bollettino where inserted_timestamp < (today-n)"
        }
      ],
      "sinks": [
        {
          "dataset": {
            "referenceName": "onlineMessaggiDataset",
            "type": "DatasetReference"
          },
          "name": "executeMessaggiDeleteDB",
          "description": "Delete messaggi data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineCdInfoPagamentoDataset",
            "type": "DatasetReference"
          },
          "name": "executeCdInfoPagamentoDeleteDB",
          "description": "Delete cd_info_pagamento data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRptVersamentiBolloDataset",
            "type": "DatasetReference"
          },
          "name": "executeRptVersamentiBolloDeleteDB",
          "description": "Delete rpt_versamenti_bollo data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRptVersamentiDataset",
            "type": "DatasetReference"
          },
          "name": "executeRptVersamentiDeleteDB",
          "description": "Delete rpt_versamenti data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRptSoggettiDataset",
            "type": "DatasetReference"
          },
          "name": "executeRptSoggettiDeleteDB",
          "description": "Delete rpt_soggetti data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRptActivationsDataset",
            "type": "DatasetReference"
          },
          "name": "executeRptActivationsDeleteDB",
          "description": "Delete rpt_activations data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineStatiRptDataset",
            "type": "DatasetReference"
          },
          "name": "executeStatiRptDeleteDB",
          "description": "Delete stati_rpt data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineStatiRptSnapshotDataset",
            "type": "DatasetReference"
          },
          "name": "executeStatiRptSnapshotDeleteDB",
          "description": "Delete stati_rpt_snapshot data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineStatiCarrelloDataset",
            "type": "DatasetReference"
          },
          "name": "executeStatiCarrelloDeleteDB",
          "description": "Delete stati_carrello data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineStatiCarrelloSnapshotDataset",
            "type": "DatasetReference"
          },
          "name": "executeStatiCarrelloSnapshotDeleteDB",
          "description": "Delete stati_carrello_snapshot data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRtVersamentiBolloDataset",
            "type": "DatasetReference"
          },
          "name": "executeRtVersamentiBolloDeleteDB",
          "description": "Delete rt_versamenti_bollo data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRtVersamentiDataset",
            "type": "DatasetReference"
          },
          "name": "executeRtVersamentiDeleteDB",
          "description": "Delete rt_versamenti data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRtXmlDataset",
            "type": "DatasetReference"
          },
          "name": "executeRtXmlDeleteDB",
          "description": "Delete rt_xml data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRptXmlDataset",
            "type": "DatasetReference"
          },
          "name": "executeRptXmlDeleteDB",
          "description": "Delete rpt_xml data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePmSessionDataDataset",
            "type": "DatasetReference"
          },
          "name": "executePmSessionDataDeleteDB",
          "description": "Delete pm_session_data data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePmMetadataDataset",
            "type": "DatasetReference"
          },
          "name": "executePmMetadataDeleteDB",
          "description": "Delete pm_metadata data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineIdempotencyCacheDataset",
            "type": "DatasetReference"
          },
          "name": "executeIdempotencyCacheDeleteDB",
          "description": "Delete idempotency_cache data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineNmuCancelUtilityDataset",
            "type": "DatasetReference"
          },
          "name": "executeNmuCancelUtilityDeleteDB",
          "description": "Delete nmu_cancel_utility data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionActivateDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionActivateDeleteDB",
          "description": "Delete position_activate data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionPaymentStatusDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionPaymentStatusDeleteDB",
          "description": "Delete position_payment_status data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionPaymentStatusSnapshotDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionPaymentStatusSnapshotDeleteDB",
          "description": "Delete position_payment_status_snapshot\n data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionReceiptRecipientStatusDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionReceiptRecipientStatusDeleteDB",
          "description": "Delete position_receipt_recipient_status data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionReceiptTransferDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionReceiptTransferDeleteDB",
          "description": "Delete position_receipt_transfer data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionTransferDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionTransferDeleteDB",
          "description": "Delete position_transfer data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionReceiptRecipientDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionReceiptRecipientDeleteDB",
          "description": "Delete position_receipt_recipient data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionReceiptXmlDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionReceiptXmlDeleteDB",
          "description": "Delete position_receipt_xml data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionReceiptDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionReceiptDeleteDB",
          "description": "Delete position_receipt data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineTokenUtilityDataset",
            "type": "DatasetReference"
          },
          "name": "executeTokenUtilityDeleteDB",
          "description": "Delete token_utility data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionPaymentDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionPaymentDeleteDB",
          "description": "Delete position_payment data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionPaymentPlanDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionPaymentPlanDeleteDB",
          "description": "Delete position_payment_plan data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionStatusDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionStatusDeleteDB",
          "description": "Delete position_status data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionStatusSnapshotDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionStatusSnapshotDeleteDB",
          "description": "Delete position_status_snapshot data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionServiceDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionServiceDeleteDB",
          "description": "Delete position_service data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionSubjectDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionSubjectDeleteDB",
          "description": "Delete position_subject data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionTransferMbdDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionTransferMbdDeleteDB",
          "description": "Delete position_transfer_mbd data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRtDataset",
            "type": "DatasetReference"
          },
          "name": "executeRtDeleteDB",
          "description": "Delete rt data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRptDataset",
            "type": "DatasetReference"
          },
          "name": "executeRptDeleteDB",
          "description": "Delete rpt data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineCarrelloDataset",
            "type": "DatasetReference"
          },
          "name": "executeCarrelloDeleteDB",
          "description": "Delete carrello data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRetryRptNotificaCancellazioneDataset",
            "type": "DatasetReference"
          },
          "name": "executeRetryRptNotificaCancellazioneDeleteDB",
          "description": "Delete retry_rpt_notifica_cancellazione data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRetryRptDataset",
            "type": "DatasetReference"
          },
          "name": "executeRetryRptDeleteDB",
          "description": "Delete retry_rpt data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRetryPaAttivaRptDataset",
            "type": "DatasetReference"
          },
          "name": "executeRetryPaAttivaRptDeleteDB",
          "description": "Delete retry_pa_attiva_rpt data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRetryPspNotificaCancellazioneRptDataset",
            "type": "DatasetReference"
          },
          "name": "executeRetryPspNotificaCancellazioneRptDeleteDB",
          "description": "Delete retry_psp_notifica_cancellazione_rpt data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRetryPspAckDataset",
            "type": "DatasetReference"
          },
          "name": "executeRetryPspAckDeleteDB",
          "description": "Delete retry_psp_ack data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRetryPaInviaRtDataset",
            "type": "DatasetReference"
          },
          "name": "executeRetryPaInviaRtDeleteDB",
          "description": "Delete retry_pa_invia_rt data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionRetrySendpaymentresultDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionRetrySendpaymentresultDeleteDB",
          "description": "Delete position_retry_sendpaymentresult data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionRetryPspSendPaymentDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionRetryPspSendPaymentDeleteDB",
          "description": "Delete position_retry_psp_send_payment data on db"
        },
        {
          "dataset": {
            "referenceName": "onlinePositionRetryPaSendRtDataset",
            "type": "DatasetReference"
          },
          "name": "executePositionRetryPaSendRtDeleteDB",
          "description": "Delete position_retry_pa_send_rt data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineRegistroChiamateNotificaRtDataset",
            "type": "DatasetReference"
          },
          "name": "executeRegistroChiamateNotificaRtDeleteDB",
          "description": "Delete registro_chiamate_notifica_rt data on db"
        },
        {
          "dataset": {
            "referenceName": "onlineVerificaBollettinoDataset",
            "type": "DatasetReference"
          },
          "name": "executeVerificaBollettinoDeleteDB",
          "description": "Delete verifica_bollettino data on db"
        }
      ],
      "transformations": [
        {
          "name": "markRecordMessaggiToDelete",
          "description": "deleting record if timestamp_evento < now - 'n days'"
        },
        {
          "name": "markRecordMessaggiToDelete",
          "description": "deleting record if inserted_timestamp < now - 'n days'"
        }
      ],
      "scriptLines": [
        "parameters{",
        "     daysToKeep as integer (90),",
        "     fileNameSuffix as string (\"-until-\"+toString(subDays(currentDate(\"GMT+1:00\"),$daysToKeep),'yyyyMMdd'))",
        "}",
        "source(output(",
        "          id as long,",
        "          id_sessione as string,",
        "          id_dominio as string,",
        "          iuv as string,",
        "          ccp as string,",
        "          id_carrello as string,",
        "          tipo as string,",
        "          timestamp_evento as timestamp,",
        "          source as string,",
        "          source_type as string",
        "     ),",
        "     allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "source(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     isolationLevel: 'READ_UNCOMMITTED',",
        "     query: (\"SELECT * FROM online.messaggi WHERE timestamp_evento < (NOW()::date - '{$daysToKeep} DAY'::interval)\"),",
        "     format: 'query') ~> messaggiRead",
        "messaggiRead alterRow(deleteIf(toDate(toString(timestamp_evento,'dd-MM-yyyy','it-IT'),'dd-MM-yyyy','it-IT')<currentDate())) ~> markRecordMessaggiToDelete",
        "markRecordMessaggiToDelete sink(allowSchemaDrift: false,",
        "     validateSchema: false,",
        "     input(",
        "          id as decimal(0,0),",
        "          id_sessione as string,",
        "          id_dominio as string,",
        "          iuv as string,",
        "          ccp as string,",
        "          id_carrello as string,",
        "          tipo as string,",
        "          timestamp_evento as timestamp,",
        "          source as string,",
        "          source_type as string",
        "     ),",
        "     deletable:true,",
        "     insertable:false,",
        "     updateable:false,",
        "     upsertable:false,",
        "     keys:['id'],",
        "     format: 'table',",
        "     skipDuplicateMapInputs: true,",
        "     skipDuplicateMapOutputs: true) ~> executeMessaggiDeleteDB"
      ]
    }
  }
}
