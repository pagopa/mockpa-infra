<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-latest.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

<!-- create sequence section --> 

    <changeSet author="liquibase" id="1674746921542-22">
        <createSequence cacheSize="1" cycle="false" dataType="bigint" incrementBy="1" maxValue="9223372036854775807" minValue="1" sequenceName="iban_seq" startValue="2000000"/>
    </changeSet>
    <changeSet author="liquibase" id="1674746921542-27">
        <createSequence cacheSize="1" cycle="false" dataType="bigint" incrementBy="1" maxValue="9223372036854775807" minValue="1" sequenceName="iban_attributes_master_seq" startValue="2000000"/>
    </changeSet>
    <changeSet author="liquibase" id="1674746921542-29">
        <createSequence cacheSize="1" cycle="false" dataType="bigint" incrementBy="1" maxValue="9223372036854775807" minValue="1" sequenceName="iban_attributes_seq" startValue="2000000"/>
    </changeSet>
    <changeSet author="liquibase" id="1674746921542-4">
        <createSequence cacheSize="1" cycle="false" dataType="bigint" incrementBy="1" maxValue="9223372036854775807" minValue="1" sequenceName="ica_binary_file_seq" startValue="2000000"/>
    </changeSet>
    <changeSet author="liquibase" id="1674746921542-23">
        <createSequence cacheSize="1" cycle="false" dataType="bigint" incrementBy="1" maxValue="9223372036854775807" minValue="1" sequenceName="iban_master_seq" startValue="2000000"/>
    </changeSet>
    
 
<!-- create table section -->    
    
    <changeSet author="liquibase" id="1674746921542-66">
        <createTable tableName="iban">
            <column defaultValueComputed="nextval('iban_seq'::regclass)" name="obj_id" type="numeric">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_iban"/>
            </column>
            <column name="iban" type="VARCHAR(35)">
                <constraints nullable="false"/>
            </column>
            <column name="fiscal_code" type="VARCHAR(55)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    
    <changeSet author="liquibase" id="1674746921542-67">
        <createTable tableName="iban_attributes_master">
            <column defaultValueComputed="nextval('iban_attributes_master_seq'::regclass)" name="obj_id" type="numeric">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_iban_attributes_master"/>
            </column>
            <column name="fk_iban_master" type="numeric"/>
            <column name="fk_iban_attribute" type="numeric"/>
        </createTable>
    </changeSet>
    
    <changeSet author="liquibase" id="1674746921542-69">
        <createTable tableName="iban_attributes">
            <column defaultValueComputed="nextval('iban_attributes_seq'::regclass)" name="obj_id" type="numeric">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_iban_attributes"/>
            </column>
            <column name="attribute_name" type="VARCHAR(70)">
                <constraints nullable="false"/>
            </column>
            <column name="attribute_description" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    
    <changeSet author="liquibase" id="1674746921542-44">
        <createTable tableName="ica_binary_file">
            <column defaultValueComputed="nextval('ica_binary_file_seq'::regclass)" name="obj_id" type="numeric">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_ica_binary_file"/>
            </column>
            <column name="file_content" type="BYTEA">
                <constraints nullable="false"/>
            </column>
            <column name="file_hash" type="BYTEA">
                <constraints nullable="false"/>
            </column>
            <column name="file_size" type="numeric">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    
    <changeSet author="liquibase" id="1674746921542-67">
        <createTable tableName="iban_master">
            <column defaultValueComputed="nextval('iban_master_seq'::regclass)" name="obj_id" type="numeric">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_iban_master"/>
            </column>
            <column name="inserted_date" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="validity_date" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="state" type="VARCHAR(10)"/>
            <column name="fk_pa" type="numeric"/>
            <column name="fk_iban" type="numeric"/>
            <column name="fk_ica_binary_file" type="numeric"/>
        </createTable>
    </changeSet>
   
<!-- create index section --> 
    
    

<!-- create fk section --> 
    <changeSet author="liquibase" id="1674746921542-123">
        <addForeignKeyConstraint baseColumnNames="fk_iban_master" baseTableName="iban_attributes_master" constraintName="fk_iban_attributes_master_to_iban_master" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="obj_id" referencedTableName="iban_attributes_master" validate="true"/>
    </changeSet>
    <changeSet author="liquibase" id="1674746921542-121">
        <addForeignKeyConstraint baseColumnNames="fk_iban_attribute" baseTableName="iban_attributes_master" constraintName="fk_iban_attributes_master_to_iban_attributes" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="obj_id" referencedTableName="iban_attributes" validate="true"/>
    </changeSet>
    <changeSet author="liquibase" id="1674746921542-97">
        <addForeignKeyConstraint baseColumnNames="fk_pa" baseTableName="iban_master" constraintName="fk_iban_master_to_pa" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="obj_id" referencedTableName="pa" validate="true"/>
    </changeSet>
    <changeSet author="liquibase" id="1674746921542-99">
        <addForeignKeyConstraint baseColumnNames="fk_ica_binary_file" baseTableName="iban_master" constraintName="fk_iban_master_to_ica_binary_file" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="obj_id" referencedTableName="ica_binary_file" validate="true"/>
    </changeSet>
    <changeSet author="liquibase" id="1674746921542-117">
        <addForeignKeyConstraint baseColumnNames="fk_iban" baseTableName="iban_master" constraintName="fk_iban_master_to_iban" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="obj_id" referencedTableName="iban" validate="true"/>
    </changeSet>
</databaseChangeLog>
